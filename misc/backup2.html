<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>
      <!DOCTYPE html>
      <html>
      <head>
        <title>Importing</title>
        <link rel="stylesheet" href="../css/style.css">
        <script src="https://unpkg.com/d3@5.6.0/dist/d3.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
        <script src="https://unpkg.com/read-excel-file@5.x/bundle/read-excel-file.min.js"></script>
        <style>
          *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family: Poppins,sans-serif;
          }
        </style>

      </head>
<body>

<nav>
  <div class="logo">
    <h4><a href="../Homepage.html">STRATAVIS</a></h4>
  </div>
  <ul class="nav-links">
    <li>
      <a href="../Homepage.html">Home</a>
    </li>
    <li>
      <a href="../gui/About.html">About</a>
    </li>
    <li>
      <a href="../gui/Dashboard.html">Dashboard</a>
    </li>
    <li>
      <a href="../gui/Contact.html">Contact Us</a>
    </li>
  </ul>

  <div class="burger">
    <div class="line1"></div>
    <div class="line2"></div>
    <div class="line3"></div>
  </div>
</nav>

<div id="form-wrapper">

  <div id="particles-js">
    <script src="../js/particles.js"></script>
    <script src="../js/app.js"></script>
  </div>

  <div class="container">
    <div class="input_form">
      <form  method="POST">

        <h1 class="form-header">Please insert your data</h1>

        <label id="fname">First Name</label>
        <input type="text" placeholder="John" name="name" required><br/><br/>

        <label id="lname">Last Name</label>
        <input type="text" placeholder="Doe" name="name" required><br/><br/>

        <label id="email">Email</label>
        <input type="text" placeholder="Enter email" name="email" required><br/><br/>

        <label id="phone">Phone No.</label>
        <input type="text" placeholder="Enter phone" name="phone" required><br/><br/>


        <input type="file"  id="upload_file" accept=".xls,.xlsx,.csv"/>


        <label id="display"></label><br/><br/>
        <script>


          const dropdownMenu = (selection,props) => {
            const{
              options,
              onOptionClicked,
              selectedOption
            } = props;

            let select = selection.selectAll('select').data([null]);
            select = select.enter()
              .append('select')
              .merge(select)
              .on('change',function() {
                onOptionClicked(this.value);
              });

            const option = select.selectAll('option').data(options);
            option.enter().append('option').merge(option)
              .attr('value',d => d)
              .property('selected',d => d === selectedOption)
              .text(d => d);
          };

          let data;
          var columnName
          let dataRow;

          const onColumnClicked = column =>{
            columnName[0] = column;
            render();
          };

          const render = () => {
            d3.select('#columns')
              .call(dropdownMenu,{
                options:columnName,
                onOptionClicked: onColumnClicked,
                selectedOption : columnName[0]
              });

          }

          /**

           Parsing Excel File

           **/
          let selectedFile;
          let upload = document.getElementById('upload_file');
          upload.addEventListener("change", (event) => {
            selectedFile = event.target.files[0];

            if(selectedFile){
              let fileReader = new FileReader();
              fileReader.readAsBinaryString(selectedFile);

              fileReader.onload = (event) => {
                let data = event.target.result;
                let wb = XLSX.read(data,{type:"binary"});

                wb.SheetNames.forEach(sheet =>{
                  let dataRow = XLSX.utils.sheet_to_row_object_array(wb.Sheets[sheet]);
                });

                columnName = wb.SheetNames;
                render(columnName);
              }
            }
          })




        </script>
        <label id="char" >Please choose 1 characteristic to be grouped by</label>

        <div id="columns">


        </div><br/><br/>

        <div class="dataNumber">
          <label id="dataNumber">Please enter the number of data to sample: </label>
          <input type="text" placeholder="123" name="dataNumber" required><br/><br/>
        </div>

        <div class="clearfix">
          <a href="../Homepage.html"></a>
          <span><button  class="form-button">Cancel</button></span>
          <span><button type="submit" class="form-button">Sample</button></span>
        </div>

      </form>
    </div>
  </div>

  <script src="../js/navigationMenu.js"></script>

</div>
</body>

</html>
</title>
</head>
<body>

</body>
</html>

let sampleClicked = document.getElementById('input-form');

sampleClicked.addEventListener("submit", function sampleData(){

let userNoOfData = document.getElementById('dataNumber').value;
let selectedColumn = document.getElementById('columns').value;
let excelData = dataRow;
let selectedColumnJSON = JSON.stringify(selectedColumn);
var output = _(excelData) //begin chaining syntax
.groupBy(selectedColumnJSON); //split into groups

console.log(output);
output.map(function (selectedColumn) { //for each group

return _.sampleSize(selectedColumn, userNoOfData); //sample n items randomly
})
.flatten() //flatten array of arrays into a single array
.value();
console.log(output);
});
